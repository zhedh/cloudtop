<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cloudtop 前端性能监控大盘</title>
  <script>
    var Cloudtop = function () { "use strict"; var e, t; (t = e || (e = {})).GET = "GET", t.POST = "POST", t.PUT = "PUT", t.DELETE = "DELETE"; var r = function (t, r) { return function (t, r, n) { return new Promise((function (o, s) { try { var a = new XMLHttpRequest; a.open(t, r), t === e.POST ? (a.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"), a.send(new URLSearchParams(n))) : (a.setRequestHeader("Content-Type", "application/json;charset=UTF-8"), a.send()), a.onreadystatechange = function () { a.readyState === XMLHttpRequest.DONE && 200 === a.status ? o(JSON.parse(a.response)) : new Error(a.response) } } catch (e) { s(e) } })) }(e.POST, t, r) }, n = function () { var e = +new Date; return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (function (t) { var r = (e + 16 * Math.random()) % 16 | 0; return e = Math.floor(e / 16), ("x" == t ? r : 3 & r | 8).toString(16) })) }; const o = "__CLOUDTOP_UID__", s = () => { let e = localStorage.getItem(o); return e || (e = n(), localStorage.setItem(o, e), e) }, a = e => { const { pathname: t } = window.location; switch (e) { case "history": default: return t; case "hash": const e = /^#(.*)\?/, [r, n] = e.exec(window.location.hash) || []; return null != n ? n : "" } }, i = () => { const e = window.navigator; if (e) { const t = e.connection || e.mozConnection || e.webkitConnection; if (t && t.effectiveType) return t.effectiveType } return "unknown" }; var c = (e => (e.PV = "pv", e.ERROR = "error", e.RESOURCE_ERROR = "resource_error", e.PERF = "perf", e.API = "api", e))(c || {}), l = Object.defineProperty, p = Object.defineProperties, d = Object.getOwnPropertyDescriptors, u = Object.getOwnPropertySymbols, h = Object.prototype.hasOwnProperty, f = Object.prototype.propertyIsEnumerable, m = (e, t, r) => t in e ? l(e, t, { enumerable: !0, configurable: !0, writable: !0, value: r }) : e[t] = r, v = (e, t) => { for (var r in t || (t = {})) h.call(t, r) && m(e, r, t[r]); if (u) for (var r of u(t)) f.call(t, r) && m(e, r, t[r]); return e }; const y = e => { var t, r, n, o, s, a, i; return e instanceof SyntaxError || e instanceof TypeError || e instanceof ReferenceError || e instanceof RangeError || e instanceof URIError ? { name: e.name, message: e.message, stack: e.stack, error: (a = v({}, e), i = { name: null != (t = e.name) ? t : "", message: null != (r = e.message) ? r : "", stack: null != (n = e.stack) ? n : "" }, p(a, d(i))) } : { name: "CustomError", message: null != (o = e.message) ? o : "string" == typeof e ? e : JSON.stringify(e), stack: null != (s = null == e ? void 0 : e.stack) ? s : "", error: e } }, g = e => { const t = [e.localName]; for (; e.parentElement;)e = e.parentElement, t.unshift(e.localName); return t.join(".") }, b = (e, t) => { t((e => { const { localName: t, src: r, href: n, nodeName: o } = e.target || {}; if (t) { if (0 === window.location.href.indexOf(r || n)) return; const s = /https?:\/\/([0-9a-zA-Z]{0,62}(\.[0-9a-zA-Z]{0,62})+)(\/.*)(\?|\#)?/, [a, i, l, p] = s.exec(r || n); return { src: r || n, nodeName: o, xpath: g(e.target), resType: t, resName: p, domain: i, type: c.RESOURCE_ERROR } } const { message: s, lineno: a, colno: i, filename: l, error: p } = e, { name: d, stack: u, error: h } = y(p); return { type: c.ERROR, category: d, msg: s, stack: u, file: l, line: a, col: i, error: JSON.stringify(h) } })(e)) }, w = (e, t) => { t((e => { const { message: t, error: r } = y(e.reason); return { type: c.ERROR, category: "PromiseRejection", msg: t, error: r } })(e)) }, E = e => { e({ type: c.PV, dt: document.title, dr: document.referrer, de: document.characterSet, dpr: String(window.devicePixelRatio), lang: document.documentElement.lang }) }; var x = Object.defineProperty, O = Object.defineProperties, I = Object.getOwnPropertyDescriptors, R = Object.getOwnPropertySymbols, P = Object.prototype.hasOwnProperty, S = Object.prototype.propertyIsEnumerable, L = (e, t, r) => t in e ? x(e, t, { enumerable: !0, configurable: !0, writable: !0, value: r }) : e[t] = r; const j = e => { window.addEventListener("load", (t => { new Promise((e => { new PerformanceObserver((t => { const r = t.getEntries(), n = r[r.length - 1] || {}; e(n.renderTime || n.loadTime) })).observe({ entryTypes: ["largest-contentful-paint"] }) })).then((t => { const r = (() => { const [e] = window.performance.getEntries(); return { type: c.PERF, redirectTime: e.redirectEnd - e.redirectStart, appDns: e.domainLookupStart - e.fetchStart, dns: e.domainLookupEnd - e.domainLookupStart, tcp: e.connectEnd - e.connectStart, ssl: e.connectEnd - e.secureConnectionStart, ttfb: e.responseStart - e.requestStart, trans: e.responseEnd - e.responseStart, dom: e.domComplete - e.responseEnd, res: e.loadEventEnd - e.domContentLoadedEventEnd, firstbyte: e.responseStart - e.domainLookupStart, fpt: e.responseEnd - e.fetchStart, tti: e.domInteractive - e.fetchStart, ready: e.domContentLoadedEventEnd - e.fetchStart, load: e.loadEventEnd - e.fetchStart, lcp: 0 } })(); var n; e((n = ((e, t) => { for (var r in t || (t = {})) P.call(t, r) && L(e, r, t[r]); if (R) for (var r of R(t)) S.call(t, r) && L(e, r, t[r]); return e })({}, r), O(n, I({ lcp: t })))) })) }), !0) }; var T = Object.defineProperty, k = (e, t, r) => (((e, t, r) => { t in e ? T(e, t, { enumerable: !0, configurable: !0, writable: !0, value: r }) : e[t] = r })(e, "symbol" != typeof t ? t + "" : t, r), r); const U = new class { constructor() { k(this, "callbacks"), this.callbacks = [] } dispatch(e) { this.callbacks.forEach((t => t(e))) } addListener(e) { this.callbacks.push(e) } removeListener(e) { const t = this.callbacks.findIndex((t => t === e)); t > -1 && this.callbacks.splice(t, 1) } }, C = (e, t) => { if (0 === e) return !0; const r = null == t ? void 0 : t.split("?")[0]; return !!/https?:\/\/.+\/.*\.([^/.]+)$/.test(r) }, D = window.fetch; window.fetch = (e, t) => { const r = performance.now(); return D(e, t).then((e => { const t = performance.now(); return N(e, t - r), e }), (e => { const t = performance.now(); return N(e, t - r), Promise.reject(e) })) }; const N = (e, t) => { var r; try { if (C(e.status, e.url)) return; U.dispatch({ api: null == (r = e.url) ? void 0 : r.split("?")[0], success: e.ok ? 1 : 0, status: e.status, msg: e.statusText, time: t }) } catch (e) { console.log(e) } }, M = XMLHttpRequest.prototype.send; XMLHttpRequest.prototype.send = function (e) { const t = performance.now(), r = e => { const n = performance.now(); _(e, n - t), this.removeEventListener("error", r), this.removeEventListener("load", r) }; this.addEventListener("error", r), this.addEventListener("load", r), M.call(this, e) }; const _ = (e, t) => { var r; try { const n = e.target, o = n.status >= 200 && n.status < 400; if (C(n.status, n.responseURL)) return; U.dispatch({ api: null == (r = n.responseURL) ? void 0 : r.split("?")[0], success: o ? 1 : 0, status: n.status, msg: n.statusText || (o ? "" : n.responseText), time: t }) } catch (e) { console.log(e) } }; var q = Object.defineProperty, H = Object.getOwnPropertySymbols, J = Object.prototype.hasOwnProperty, A = Object.prototype.propertyIsEnumerable, X = (e, t, r) => t in e ? q(e, t, { enumerable: !0, configurable: !0, writable: !0, value: r }) : e[t] = r; const z = (e, t) => { U.addListener((r => { return n = void 0, o = null, s = function* () { const { api: n } = r; n.includes(t) || e(((e, t) => { for (var r in t || (t = {})) J.call(t, r) && X(e, r, t[r]); if (H) for (var r of H(t)) A.call(t, r) && X(e, r, t[r]); return e })({ type: c.API }, r)) }, new Promise(((e, t) => { var r = e => { try { i(s.next(e)) } catch (e) { t(e) } }, a = e => { try { i(s.throw(e)) } catch (e) { t(e) } }, i = t => t.done ? e(t.value) : Promise.resolve(t.value).then(r, a); i((s = s.apply(n, o)).next()) })); var n, o, s })) }; var F = Object.defineProperty, B = Object.getOwnPropertySymbols, G = Object.prototype.hasOwnProperty, V = Object.prototype.propertyIsEnumerable, Z = (e, t, r) => t in e ? F(e, t, { enumerable: !0, configurable: !0, writable: !0, value: r }) : e[t] = r, W = (e, t) => { for (var r in t || (t = {})) G.call(t, r) && Z(e, r, t[r]); if (B) for (var r of B(t)) V.call(t, r) && Z(e, r, t[r]); return e }, $ = (e, t, r) => (Z(e, "symbol" != typeof t ? t + "" : t, r), r); return class { constructor(e) { var t, r, o, s, i, c, l; $(this, "baseURL"), $(this, "clientIp"), $(this, "projectId"), $(this, "env"), $(this, "sessionId"), $(this, "loginId"), $(this, "extend"), $(this, "pvId"), $(this, "reportType"), $(this, "routeMode"), $(this, "page"), e.baseURL ? e.projectId ? (this.baseURL = e.baseURL, this.clientIp = null != (t = e.clientIp) ? t : "", this.projectId = e.projectId, this.env = null != (r = e.env) ? r : "production", this.sessionId = null != (o = e.sessionId) ? o : "", this.loginId = null != (s = e.loginId) ? s : "", this.extend = null != (i = e.extend) ? i : "", this.reportType = null != (c = e.reportType) ? c : "beacon", this.routeMode = null != (l = e.routeMode) ? l : "history", this.pvId = n(), this.page = a(this.routeMode), this.bootstrap()) : console.error("projectId 未配置，前端性能监控上报不生效") : console.error("baseURL 未配置，前端性能监控上报不生效") } setConfig(e) { var t, r, n, o; this.clientIp = null != (t = e.clientIp) ? t : this.clientIp, this.sessionId = null != (r = e.sessionId) ? r : this.sessionId, this.loginId = null != (n = e.loginId) ? n : this.loginId, this.extend = null != (o = e.extend) ? o : this.extend } getCommonData() { var e; const { clientWidth: t = 0, clientHeight: r = 0 } = document.body || {}, { width: n, height: o } = window.screen || {}, c = "string" == typeof this.extend ? this.extend : JSON.stringify(this.extend); return { reportTime: +new Date, pid: this.projectId, env: this.env, clientIp: this.clientIp, ct: i(), pvId: this.pvId, page: null != (e = this.page) ? e : a(this.routeMode), url: window.location.href, sr: n + "*" + o, vp: t + "*" + r, sid: this.sessionId, uid: s(), loginId: this.loginId, ext: c } } report(e) { return t = this, n = null, o = function* () { const t = W(W({}, this.getCommonData()), e); if ("beacon" === this.reportType && navigator.sendBeacon) return function (e, t) { return navigator.sendBeacon(e, JSON.stringify(t)) }(this.baseURL, t); const n = JSON.stringify(t).length; return "img" === this.reportType || n < 2e3 ? function (e, t) { var r = new Image, n = -1 === e.indexOf("?") ? "?" : "&"; r.src = "".concat(e).concat(n, "data=").concat(encodeURIComponent(JSON.stringify(t))), r = null }(this.baseURL + "/log.png", t) : r(this.baseURL, t) }, new Promise(((e, r) => { var s = e => { try { i(o.next(e)) } catch (e) { r(e) } }, a = e => { try { i(o.throw(e)) } catch (e) { r(e) } }, i = t => t.done ? e(t.value) : Promise.resolve(t.value).then(s, a); i((o = o.apply(t, n)).next()) })); var t, n, o } routeChange(e) { e && e === this.page || (this.pvId = n(), this.page = null != e ? e : a(this.routeMode), E(this.report.bind(this))) } bootstrap() { var e; this.routeChange(), e = this.report.bind(this), window.addEventListener("error", (t => (t.preventDefault(), b(t, e))), !0), (e => { window.addEventListener("unhandledrejection", (t => (t.preventDefault(), w(t, e))), !0) })(this.report.bind(this)), j(this.report.bind(this)), z(this.report.bind(this), this.baseURL) } } }();
  </script>
  <script>
    window.cloudtop = new Cloudtop({
      baseURL: 'http://cloudtop-server.juyangkaifa.com',
      projectId: 'cloudtop_monitor',
      env: 'production', // 上报环境
      reportType: 'beacon', // 上报方式
    })
  </script>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
</body>

</html>